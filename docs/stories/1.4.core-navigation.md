# Story 1.4: Core Navigation & Layout Structure

## Status

Approved

## Story

**As an** authenticated user,
**I want** to navigate between different pages using a sidebar and mobile bottom navigation,
**so that** I can easily access all features of the application.

## Acceptance Criteria

1. Desktop sidebar navigation component created with:
   - App logo/brand at top
   - Navigation links for: Daily, Calories, Injections, Nirvana, Winners Bible, Analytics, Settings
   - Icons from Heroicons (outline for inactive, solid for active)
   - Active state styling with primary color background
   - Fixed width 256px on desktop
2. Mobile bottom navigation component created with:
   - Fixed position at bottom of viewport
   - 4 primary navigation items (Daily, Calories, Injections, Analytics)
   - Hamburger menu for remaining pages
   - Active state indicator
3. Top header navigation component created for desktop with:
   - Logo on left
   - Horizontal navigation links in center
   - Icon-only buttons on right (Settings, Logout)
4. Navigation components use Next.js Link for client-side routing
5. Active route determined via usePathname() hook
6. Layout wrapper component integrates navigation based on screen size (responsive)
7. All navigation links functional and route to correct pages (even if pages show placeholder content initially)

## Tasks / Subtasks

- [ ] Task 1: Create desktop sidebar navigation component (AC: 1, 4, 5)
  - [ ] Create src/components/navigation/Sidebar.tsx component
  - [ ] Import Heroicons: HomeIcon, ScaleIcon, BeakerIcon, SparklesIcon, BookOpenIcon, ChartBarIcon, Cog6ToothIcon
  - [ ] Define navigation items array with label, href, icon (outline), iconActive (solid)
  - [ ] Use usePathname() hook to determine active route
  - [ ] Render Next.js Link components for each nav item
  - [ ] Apply active state styling: bg-primary (#00A1FE), text-white for active route
  - [ ] Add logo/brand at top (placeholder or actual logo image)
  - [ ] Set fixed width 256px and full height with dark background
  - [ ] Test navigation and verify active states work correctly

- [ ] Task 2: Create mobile bottom navigation component (AC: 2, 4, 5)
  - [ ] Create src/components/navigation/BottomNav.tsx component
  - [ ] Include 4 primary nav items: Daily, Calories, Injections, Analytics
  - [ ] Add hamburger menu button (Bars3Icon from Heroicons) for overflow items
  - [ ] Position fixed at bottom with z-index above content
  - [ ] Apply active state indicator (blue underline or filled icon)
  - [ ] Create mobile menu drawer for hamburger (Nirvana, Winners Bible, Settings)
  - [ ] Use Headless UI Transition for smooth drawer animation
  - [ ] Test on mobile viewport and verify touch targets are 44px minimum

- [ ] Task 3: Create top header navigation for desktop (AC: 3, 4)
  - [ ] Create src/components/navigation/Header.tsx component
  - [ ] Add logo on left side
  - [ ] Add horizontal navigation links in center (same items as sidebar)
  - [ ] Add Settings and Logout icon buttons on right (Cog6ToothIcon, ArrowRightOnRectangleIcon)
  - [ ] Implement logout handler using AuthContext signOut function
  - [ ] Apply dark header background with bottom border
  - [ ] Make header sticky on scroll (optional)
  - [ ] Test header on desktop and verify logout works

- [ ] Task 4: Create responsive app layout wrapper (AC: 6)
  - [ ] Update src/app/(app)/layout.tsx to include navigation
  - [ ] Show Sidebar on desktop (min-width: 768px or 1024px breakpoint)
  - [ ] Show Header on desktop alternative OR combine with Sidebar
  - [ ] Show BottomNav on mobile (below 768px breakpoint)
  - [ ] Add padding/margin to main content area to account for navigation
  - [ ] Ensure layout is responsive and switches correctly at breakpoint
  - [ ] Test layout on various screen sizes (mobile, tablet, desktop)

- [ ] Task 5: Create placeholder pages for all routes (AC: 7)
  - [ ] Create src/app/(app)/daily/page.tsx with "Daily Tracker - Coming Soon" placeholder
  - [ ] Create src/app/(app)/calories/page.tsx placeholder
  - [ ] Create src/app/(app)/injections/page.tsx placeholder
  - [ ] Create src/app/(app)/nirvana/page.tsx placeholder
  - [ ] Create src/app/(app)/winners-bible/page.tsx placeholder
  - [ ] Create src/app/(app)/analytics/page.tsx placeholder
  - [ ] Create src/app/(app)/settings/page.tsx placeholder (will be replaced in Story 1.3)
  - [ ] Test all navigation links and verify pages load

- [ ] Task 6: Add navigation icons and design system styling (AC: 1, 2)
  - [ ] Install @heroicons/react: `npm install @heroicons/react`
  - [ ] Map navigation items to appropriate Heroicons
  - [ ] Apply Tailwind CSS classes following design system
  - [ ] Use dark theme colors: background #1a1a1a, text #e5e5e5, primary #00A1FE
  - [ ] Add hover states for nav items (lighter background)
  - [ ] Add focus states for keyboard navigation (outline ring)
  - [ ] Ensure WCAG AA contrast ratios for text and icons
  - [ ] Test with keyboard navigation (Tab, Enter)

- [ ] Task 7: Add navigation transitions and animations (Optional enhancement)
  - [ ] Add smooth transition for active state change (bg color, icon swap)
  - [ ] Add slide-in animation for mobile drawer menu
  - [ ] Add fade-in for route transitions using Headless UI Transition
  - [ ] Test animations and ensure they're not distracting
  - [ ] Consider motion preferences: respect prefers-reduced-motion

## Dev Notes

**Relevant Tech Stack:**
- **Icons**: Heroicons 2.1+ (outline and solid variants)
- **UI Components**: Headless UI 2.0+ for accessible drawers/menus
- **Styling**: Tailwind CSS with dark theme colors
- **Routing**: Next.js Link and usePathname() hook

**Navigation Structure (from front-end-spec.md):**
```
Desktop:
- Sidebar (256px fixed width) OR Top Header (horizontal)
- Logo + Navigation Links + User Menu

Mobile:
- Bottom Navigation Bar (4 primary items + hamburger)
- Drawer menu for overflow items
```

**Heroicons Mapping:**
- Daily: HomeIcon (outline/solid)
- Calories: ScaleIcon (outline/solid)
- Injections: BeakerIcon (outline/solid)
- Nirvana: SparklesIcon (outline/solid)
- Winners Bible: BookOpenIcon (outline/solid)
- Analytics: ChartBarIcon (outline/solid)
- Settings: Cog6ToothIcon (outline/solid)
- Logout: ArrowRightOnRectangleIcon (outline/solid)
- Hamburger Menu: Bars3Icon

**Design System Colors:**
- Background: #1a1a1a (dark gray)
- Text: #e5e5e5 (light gray)
- Primary: #00A1FE (bright blue)
- Active state: Primary background with white text
- Hover state: Lighter shade of background (#2a2a2a)

**Responsive Breakpoints:**
- Mobile: < 768px (show BottomNav)
- Desktop: >= 768px (show Sidebar or Header)
- Consider tablet: 768px - 1024px (optional adjustments)

**Active Route Detection:**
```typescript
'use client';
import { usePathname } from 'next/navigation';

const pathname = usePathname();
const isActive = pathname === item.href || pathname.startsWith(item.href + '/');
```

**Accessibility Requirements:**
- All nav items must be keyboard accessible (Tab, Enter)
- Active nav item should be announced by screen readers (aria-current="page")
- Mobile drawer must trap focus when open
- Icons must have accessible labels (aria-label or sr-only text)
- Minimum touch target size: 44x44px for mobile

**Key Implementation Notes:**
- Use route groups `(app)` to apply navigation layout to authenticated pages
- Auth pages `(auth)` should NOT have navigation (separate layout)
- Consider using Headless UI Menu component for user dropdown if adding profile menu
- Logout should clear auth state and redirect to /login (already implemented in Story 1.2)

**Mobile Menu Drawer Best Practices:**
- Close drawer on navigation (user taps a link)
- Close drawer on backdrop click or ESC key
- Use Headless UI Dialog for proper focus management
- Slide in from right or bottom for natural mobile UX

### Testing

**Test Location:**
- Unit tests: `tests/unit/components/navigation/`
- E2E tests: `tests/e2e/navigation.spec.ts`

**Testing Requirements for Story 1.4:**

**Unit Tests:**
1. **Sidebar Component**:
   - Test active route detection with different pathnames
   - Test navigation item rendering
   - Verify correct icons displayed for active/inactive states
2. **BottomNav Component**:
   - Test mobile drawer opens/closes correctly
   - Test active state indicator on mobile
   - Verify hamburger menu renders overflow items
3. **Header Component**:
   - Test logout button calls signOut function
   - Verify navigation items render correctly

**E2E Tests (Critical - Required):**
1. **Desktop navigation**:
   - Navigate to each page using sidebar links
   - Verify active state updates correctly
   - Test logout button redirects to /login
2. **Mobile navigation**:
   - Resize viewport to mobile width
   - Verify bottom navigation appears and sidebar hidden
   - Tap each bottom nav item and verify navigation works
   - Open hamburger menu and verify drawer appears
   - Tap overflow item in drawer and verify navigation
   - Close drawer by tapping backdrop
3. **Responsive behavior**:
   - Resize from desktop to mobile and verify layout switches
   - Verify no horizontal scrolling on mobile
   - Test at various breakpoints (320px, 768px, 1024px, 1440px)
4. **Keyboard navigation**:
   - Tab through all navigation items
   - Press Enter on nav item and verify navigation
   - Test focus trap in mobile drawer (Tab should cycle through drawer items)

**Test Scenarios:**
- User logs in and sees navigation
- User navigates to each page and verifies active state
- User resizes browser and navigation adapts
- User logs out and navigation disappears

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story creation from Epic 1 | John (PM) |

## Dev Agent Record

#### Agent Model Used

_To be populated by dev agent during implementation_

#### Debug Log References

_To be populated by dev agent during implementation_

#### Completion Notes List

_To be populated by dev agent during implementation_

#### File List

_To be populated by dev agent during implementation_

## QA Results

_To be populated by QA agent after story completion_