# Story 2.1: Daily Tracker Page Layout & Date Display

## Status

Draft

## Story

**As a** user,
**I want** to see the current date prominently displayed on my Daily Tracker,
**so that** I know which day's data I'm viewing and entering.

## Acceptance Criteria

1. Daily Tracker page created at `/app/daily/page.tsx`
2. Current date displayed prominently at top in user's timezone
3. Date format: "Monday, January 30th, 2025" (full day name, month, ordinal day, year)
4. Page title "Daily Tracker" displayed with MM design system heading styles
5. Page layout uses card-based design with dark background
6. Responsive layout: single column on mobile, multi-column grid on desktop
7. Page accessible via "Daily" link in navigation

## Tasks / Subtasks

- [ ] Task 1: Create Daily Tracker page component (AC: 1, 2, 3, 4)
  - [ ] Create `/app/daily/page.tsx` as Next.js 14 Server Component
  - [ ] Implement server-side authentication check using `createServerComponentClient`
  - [ ] Redirect unauthenticated users to `/auth/login`
  - [ ] Fetch user profile data to get timezone setting
  - [ ] Calculate current date in user's timezone using date-fns utilities
  - [ ] Format date as "Monday, January 30th, 2025" using date-fns format with ordinal day
  - [ ] Render page title "Daily Tracker" with `font-national2` class
  - [ ] Display formatted date prominently at top of page

- [ ] Task 2: Implement responsive layout structure (AC: 5, 6)
  - [ ] Create container with `container mx-auto px-4 py-8` classes
  - [ ] Apply dark background using design system color classes
  - [ ] Create grid layout with Tailwind: `grid-cols-1 md:grid-cols-2 lg:grid-cols-3` for future content sections
  - [ ] Add spacing between grid items using `gap-6`
  - [ ] Test layout on mobile (320px), tablet (768px), and desktop (1440px) viewports

- [ ] Task 3: Verify navigation integration (AC: 7)
  - [ ] Confirm Navigation component from Epic 1.4 includes "Daily" link pointing to `/daily`
  - [ ] Test navigation from other pages to Daily Tracker
  - [ ] Verify active state styling shows correctly when on Daily Tracker page

- [ ] Task 4: Add TypeScript types and error handling
  - [ ] Import `Database` type from `@/types/database.types`
  - [ ] Type user profile data as `Database['public']['Tables']['profiles']['Row']`
  - [ ] Handle case where user profile doesn't exist (redirect to profile setup)
  - [ ] Handle case where timezone is not set (default to browser timezone)

- [ ] Task 5: Write unit tests (Testing Strategy requirement)
  - [ ] Test: Page renders successfully with authenticated user
  - [ ] Test: Page redirects unauthenticated users to login
  - [ ] Test: Date displays correctly in user's configured timezone
  - [ ] Test: Date format matches specification (full day name, ordinal, year)
  - [ ] Test: Layout is responsive (snapshot tests at different viewports)

## Dev Notes

### Previous Story Insights

From Epic 1 (Stories 1.1-1.5):
- Story 1.1: Next.js 14 project is initialized with TypeScript, Tailwind CSS 4.0, and Supabase integration already complete
- Story 1.2: Authentication system is implemented with middleware protecting routes
- Story 1.3: User profile schema exists with `profiles` table including timezone field
- Story 1.4: Navigation component is implemented with Desktop sidebar and Mobile bottom nav
- Story 1.5: Timezone utilities have been created in `lib/utils/date.ts` with date-fns and date-fns-tz

**Key Context:** This story builds on the foundation from Epic 1. All authentication, navigation, and timezone infrastructure is already in place. This story focuses solely on creating the Daily Tracker page shell with proper date display.

### Data Models

**Profile Table** [Source: architecture/data-models.md#user-profile]
```typescript
export interface Profile {
  id: string; // UUID
  bmr: number;
  gender: 'male' | 'female' | 'other';
  height: number; // cm
  weight: number; // kg
  age: number;
  timezone: string; // e.g., 'America/New_York' (IANA timezone identifier)
  created_at: string; // ISO 8601
  updated_at: string; // ISO 8601
}
```

- Timezone field is required (NOT NULL with default 'UTC')
- Use timezone value for all date displays on this page

### Component Specifications

**Server Component Template** [Source: architecture/frontend-architecture.md#component-template]

This page should be a Next.js Server Component following this pattern:

```typescript
// app/daily/page.tsx
import { createServerComponentClient } from '@supabase/auth-helpers-nextjs';
import { cookies } from 'next/headers';
import { redirect } from 'next/navigation';
import { Database } from '@/types/database.types';

export default async function DailyTrackerPage() {
  const supabase = createServerComponentClient<Database>({ cookies });

  // Check authentication
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    redirect('/auth/login');
  }

  // Fetch user profile for timezone
  const { data: profile } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', user.id)
    .single();

  // Calculate current date in user's timezone
  // Use date utilities from lib/utils/date.ts

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-4xl font-national2 mb-8">Daily Tracker</h1>
      {/* Date display here */}
    </div>
  );
}
```

**Design System Classes** [Source: architecture/frontend-architecture.md + app/globals.css]
- Headings: `font-national2` (already configured in globals.css from Story 1.1)
- Cards: `card-mm` class (defined in globals.css)
- Container: `container mx-auto px-4 py-8`
- Responsive grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6`

### File Locations

[Source: architecture/unified-project-structure.md]

**Page File:**
- Location: `app/daily/page.tsx`
- Type: Next.js 14 App Router Server Component
- Route: `/daily` (automatically determined by file location)

**Imports Needed:**
- Supabase client: `@supabase/auth-helpers-nextjs`
- Database types: `@/types/database.types`
- Date utilities: `@/lib/utils/date.ts` (created in Story 1.5)
- Next.js: `next/headers` (cookies), `next/navigation` (redirect)

### Date Utilities

[Source: Story 1.5 - Timezone Configuration & Date Utilities from Epic 1]

The following utilities should exist from Story 1.5 in `lib/utils/date.ts`:
- `getCurrentDateInTimezone(timezone: string): string` - Returns current date in user's timezone
- Uses `date-fns` and `date-fns-tz` libraries
- Format date using `format()` from date-fns with pattern: `'EEEE, MMMM do, yyyy'`

Example usage:
```typescript
import { format } from 'date-fns';
import { utcToZonedTime } from 'date-fns-tz';

const userTimezone = profile.timezone || 'UTC';
const zonedDate = utcToZonedTime(new Date(), userTimezone);
const formattedDate = format(zonedDate, 'EEEE, MMMM do, yyyy');
// Output: "Monday, January 30th, 2025"
```

### Routing & Navigation

**Protected Route Pattern** [Source: architecture/frontend-architecture.md#protected-route-pattern]

Routes under `/daily` are protected by Next.js middleware (already implemented in Story 1.2):
- Middleware checks for Supabase session
- Unauthenticated requests redirect to `/login`
- Authenticated users from auth pages redirect to `/daily`

**Navigation Integration** [Source: architecture/components.md#navigation-component]

From Story 1.4, Navigation component exists with:
- Desktop sidebar with "Daily" link
- Mobile bottom nav with "Daily" as primary item
- Active state determined by `usePathname()` hook
- Should automatically highlight "Daily" when on `/daily` route

### Technical Constraints

**Type Sharing** [Source: architecture/coding-standards.md#critical-fullstack-rules]
- Use types from `src/types/` - never duplicate type definitions
- Database types auto-generated in `database.types.ts` from Supabase CLI

**Naming Conventions** [Source: architecture/coding-standards.md#naming-conventions]
- Component file: `page.tsx` (PascalCase implied by Next.js convention)
- TypeScript Types: `PascalCase` (e.g., `Profile`, `Database`)
- Functions: `camelCase` (e.g., `getCurrentDateInTimezone`)

**Timestamps** [Source: architecture/coding-standards.md#critical-fullstack-rules]
- Use UTC timestamps in database
- Convert to user's timezone ONLY in UI (this story)

### Testing

[Source: architecture/testing-strategy.md]

**Test Location:** `tests/unit/pages/daily.test.tsx`

**Test Framework:** Jest + React Testing Library

**Required Tests:**
1. Page renders with authenticated user (unit test)
2. Page redirects unauthenticated users (integration test)
3. Date displays in user's configured timezone (unit test)
4. Date format matches specification (unit test)
5. Responsive layout at 320px, 768px, 1440px (snapshot tests)

**Testing Pattern:**
- Mock Supabase client using `jest.mock('@supabase/auth-helpers-nextjs')`
- Mock user authentication state
- Mock profile data with timezone
- Test date rendering with different timezones
- Verify redirect behavior for unauthenticated users

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-30 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

_This section will be populated by the development agent during implementation._

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_This section will be populated by QA Agent after story completion._